<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml"> <head> <meta charset="utf-8"/> <title>Lichat-Tcp-Server</title> <meta name="viewport" content="width=device-width"/> <meta name="description" content="A simple TCP server implementation for lichat."/> <meta name="author" content="Nicolas Hafner &lt;shinmera@tymoon.eu&gt;"/> <style type="text/css"> body{
          max-width: 1024px;
          margin: 0 auto 0 auto;
          font-family: sans-serif;
          color: #333333;
          font-size: 14pt;
          padding: 5px;
      }
      body>header{
          display:flex;
          align-items: center;
          justify-content: center;
          flex-direction: column;
          max-width: 100%;
          text-align: center;
      }
      body>header img{
          max-width: 50%;
      }
      img{
          max-width: 100%;
          max-height: 100%;
      }
      code{
          font-family: Consolas, Inconsolata, monospace;
      }
      a{
          text-decoration: none;
          color: #0055AA;
      }
      a img{
          border: none;
      }
      #documentation{
          text-align: justify;
      }
      #documentation pre{
          margin-left: 20px;
          overflow: auto;
      }
      #documentation img{
          margin: 5px;
      }
      #symbol-index>ul{
          list-style: none;
          padding: 0;
      }
      #symbol-index .package>ul{
          list-style: none;
          padding: 0 0 0 10px;
      }
      #symbol-index .package .nicknames{
          font-weight: normal;
      }
      #symbol-index .package h4{
          display: inline-block;
          margin: 0;
      }
      #symbol-index .package article{
          margin: 0 0 15px 0;
      }
      #symbol-index .package article header{
          font-size: 1.2em;
          font-weight: normal;
      }
      #symbol-index .package .name{
          margin-right: 5px;
      }
      #symbol-index .package .docstring{
          margin: 0 0 0 15px;
          white-space: pre-wrap;
          font-size: 12pt;
      }
      @media (max-width: 800px){
          body{font-size: 12pt;}
      } </style> </head> <body> <header> <h1>lichat-tcp-server</h1> <span class="version">1.0.0</span> <p class="description">A simple TCP server implementation for lichat.</p> </header> <main> <article id="documentation">  <div><h2>About Lichat-TCP-Server</h2> <p>This is a simple, threaded, TCP-based server for the <a href="https://shirakumo.org/projects/lichat-protocol">Lichat protocol</a>.</p> <h2>How To</h2> <p>Create a new server instance and pass it whatever settings you would like.</p> <pre><code>(<a href="http://l1sp.org/cl/defvar">defvar</a> *server* (<a href="http://l1sp.org/cl/make-instance">make-instance</a> 'lichat-tcp-server:server))</code></pre> <p>Notable initargs of potential interest are:</p> <ul> <li><code>:name</code> The name the server goes by on its own network. Defaults to <code>(<a href="http://l1sp.org/cl/machine-instance">machine-instance</a>)</code>.</li> <li><code>:hostname</code> The hostname to which the TCP listener should bind. The default is <code>0.0.0.0</code>.</li> <li><code>:port</code> The port the TCP listener should listen on. The default is <code>1111</code>.</li> <li><code>:ping-interval</code> The interval in which pings should be sent out to clients. The default is <code>60</code>.</li> <li><code>:salt</code> The salt with which passwords are hashed. The default is an empty string.</li> <li><code>:idle-timeout</code> The number of seconds without a response from a client after which it is considered to have timed out. The default is <code>120</code>.</li> <li><code>:flood-frame</code> The size of a flood prevention frame. The default is <code>30</code>.</li> <li><code>:flood-limit</code> The number of allowed updates within a frame before flood limitation takes effect. The default is <code>40</code>.</li> <li><code>:connection-limit</code> The number of connections in total that the server supports before dropping incoming ones. The default is <code>100</code>.</li> </ul> <p>Once a server exists, it can be started to listen to incoming connections:</p> <pre><code>(<a href="#LICHAT-TCP-SERVER:OPEN-CONNECTION">lichat-tcp-server:open-connection</a> *server*)</code></pre> <p>The server logs information via <a href="http://shinmera.github.io/verbose/">Verbose</a>. If you set the REPL level to <code>:trace</code> you should see a bunch of status messages being printed every now and again.</p> <p>Once you're done with the server, you can shut it down again.</p> <pre><code>(<a href="#LICHAT-TCP-SERVER:CLOSE-CONNECTION">lichat-tcp-server:close-connection</a> *server*)</code></pre> <h2>Also See</h2> <ul> <li><a href="https://shirakumo.github.io/lichat-protocol">lichat-protocol</a> The Lichat protocol specification.</li> <li><a href="https://shirakumo.github.io/lichat-serverlib">lichat-serverlib</a> An agnostic implementation of the server-side protocol.</li> <li><a href="https://shirakumo.github.io/lichat-tcp-client">lichat-tcp-client</a> A basic, threaded, TCP-based implementation of a Lichat client.</li> <li><a href="https://github.com/Shirakumo/lionchat">LionChat</a> A Qt GUI client for a TCP server.</li> </ul> </div>  </article> <article id="copyright">  <h2>Copyright</h2> <span>lichat-tcp-server</span> is licensed under the <span><a href="https://tldrlegal.com/search?q=Artistic">Artistic</a></span> license.  Â© <span>Nicolas Hafner &lt;shinmera@tymoon.eu&gt;</span> .  This library can be obtained on <a href="https://github.com/Shirakumo/lichat-tcp-server">https://github.com/Shirakumo/lichat-tcp-server</a>.  </article>  <article id="symbol-index"> <h2>Package Index</h2> <ul><li class="package"> <h3> <a name="LICHAT-TCP-SERVER" href="#LICHAT-TCP-SERVER">LICHAT-TCP-SERVER</a> <span class="nicknames">(ORG.SHIRAKUMO.LICHAT.TCP-SERVER)</span> </h3> <ul><li> <a name="LICHAT-TCP-SERVER:*DEFAULT-PORT*"> </a> <article> <header class="special"> <span class="type">special</span>  <h4 class="name"><code><a href="#LICHAT-TCP-SERVER:*DEFAULT-PORT*">*DEFAULT-PORT*</a></code></h4>  </header> <div class="docstring"><pre>The standard port on which the server will run.

Should be 1111.</pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:CHANNEL"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-TCP-SERVER:CHANNEL">CHANNEL</a></code></h4>  </header> <div class="docstring"><pre>Channel class.

Access to the channel is properly handled for
mutual exclusion from threads by its LOCK. Particularly,
the following methods are mutually excluded via this lock:

  LICHAT-SERVERLIB:JOIN
  LICHAT-SERVERLIB:LEAVE

See <a href="#LICHAT-TCP-SERVER:CHANNEL">LICHAT-SERVERLIB:CHANNEL</a>
See <a href="#LICHAT-TCP-SERVER:LOCK">LOCK</a></pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:CONNECTION"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-TCP-SERVER:CONNECTION">CONNECTION</a></code></h4>  </header> <div class="docstring"><pre>Connection class. Each connection to a client will have an instance of this class.

Access to the connection is properly handled for
mutual exclusion from threads by its LOCK. Particularly,
the following methods are mutually excluded via this lock:

  LICHAT-SERVERLIB:SEND

See <a href="NIL">LICHAT-SERVERLIB:FLOOD-PROTECTED-CONNECTION</a>
See <a href="#LICHAT-TCP-SERVER:SOCKET">SOCKET</a>
See <a href="#LICHAT-TCP-SERVER:THREAD">THREAD</a>
See <a href="#LICHAT-TCP-SERVER:LOCK">LOCK</a></pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:SERVER"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-TCP-SERVER:SERVER">SERVER</a></code></h4>  </header> <div class="docstring"><pre>Server class. You should instantiate this.

Access to the server is properly handled for
mutual exclusion from threads by its LOCK. Particularly,
the following updates and processing methods for updates
are mutually excluded via this lock:

 LICHAT-SERVERLIB:TEARDOWN-CONNECTION
 LICHAT-PROTOCOL:CONNECT
 LICHAT-PROTOCOL:REGISTER
 LICHAT-PROTOCOL:CREATE

See <a href="NIL">LICHAT-SERVERLIB:FLOOD-PROTECTED-SERVER</a>
See <a href="#LICHAT-TCP-SERVER:HOSTNAME">HOSTNAME</a>
See <a href="#LICHAT-TCP-SERVER:PORT">PORT</a>
See <a href="#LICHAT-TCP-SERVER:THREAD">THREAD</a>
See <a href="#LICHAT-TCP-SERVER:PING-INTERVAL">PING-INTERVAL</a>
See <a href="#LICHAT-TCP-SERVER:LOCK">LOCK</a>
See <a href="#LICHAT-TCP-SERVER:CONNECTIONS">CONNECTIONS</a></pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:USER"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-TCP-SERVER:USER">USER</a></code></h4>  </header> <div class="docstring"><pre>User class.

Access to the user is properly handled for
mutual exclusion from threads by its LOCK. Particularly,
the following methods are mutually excluded via this lock:

  LICHAT-SERVERLIB:JOIN
  LICHAT-SERVERLIB:LEAVE

See <a href="#LICHAT-TCP-SERVER:USER">LICHAT-SERVERLIB:USER</a>
See <a href="#LICHAT-TCP-SERVER:LOCK">LOCK</a></pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:CONNECTION-LIMIT"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-TCP-SERVER:CONNECTION-LIMIT">CONNECTION-LIMIT</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <div class="docstring"><i>No docstring provided.</i></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:CONNECTIONS"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-TCP-SERVER:CONNECTIONS">CONNECTIONS</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <div class="docstring"><pre>Accessor to the list of connections on the server.

See <a href="#LICHAT-TCP-SERVER:SERVER">SERVER</a>
See <a href="#LICHAT-TCP-SERVER:CONNECTION">CONNECTION</a></pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:HOSTNAME"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-TCP-SERVER:HOSTNAME">HOSTNAME</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <div class="docstring"><pre>Accessor to the hostname of the connection.

See <a href="#LICHAT-TCP-SERVER:CONNECTION">CONNECTION</a></pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:LOCK"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-TCP-SERVER:LOCK">LOCK</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <div class="docstring"><pre>Accessor to the lock of the object that is used to mutually exclude access.

See <a href="#LICHAT-TCP-SERVER:SERVER">SERVER</a> 
See <a href="#LICHAT-TCP-SERVER:CONNECTION">CONNECTION</a>
See <a href="#LICHAT-TCP-SERVER:USER">USER</a>
See <a href="#LICHAT-TCP-SERVER:CHANNEL">CHANNEL</a></pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:PING-INTERVAL"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-TCP-SERVER:PING-INTERVAL">PING-INTERVAL</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <div class="docstring"><pre>Accessor to the amount of seconds to wait for an update before sending a PING.

See <a href="#LICHAT-TCP-SERVER:SERVER">SERVER</a></pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:PORT"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-TCP-SERVER:PORT">PORT</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <div class="docstring"><pre>Accessor to the port of the connection.

See <a href="#LICHAT-TCP-SERVER:CONNECTION">CONNECTION</a></pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:SOCKET"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-TCP-SERVER:SOCKET">SOCKET</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <div class="docstring"><pre>Accessor to the TCP socket of the connection.

See <a href="#LICHAT-TCP-SERVER:SOCKET">USOCKET:SOCKET</a>
See <a href="#LICHAT-TCP-SERVER:CONNECTION">CONNECTION</a></pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:THREAD"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-TCP-SERVER:THREAD">THREAD</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <div class="docstring"><pre>Accessor to the background processing thread of the object.

See <a href="#LICHAT-TCP-SERVER:SERVER">SERVER</a>
See <a href="#LICHAT-TCP-SERVER:CONNECTION">CONNECTION</a></pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:ENSURE-HOSTNAME"> </a> <article> <header class="function"> <span class="type">function</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-TCP-SERVER:ENSURE-HOSTNAME">ENSURE-HOSTNAME</a></code></h4> <code class="qualifiers"></code> <code class="arguments">HOST-ISH</code><code>)</code>  </header> <div class="docstring"><pre>Ensures that the host-ish is turned into a hostname string.</pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:CLOSE-CONNECTION"> </a> <article> <header class="generic"> <span class="type">generic</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-TCP-SERVER:CLOSE-CONNECTION">CLOSE-CONNECTION</a></code></h4> <code class="qualifiers"></code> <code class="arguments">SERVER</code><code>)</code>  </header> <div class="docstring"><pre>Stop accepting incoming connections and close all existing ones.

Can be used with either a SERVER or a CONNECTION.

See <a href="#LICHAT-TCP-SERVER:CONNECTIONS">CONNECTIONS</a>
See <a href="#LICHAT-TCP-SERVER:THREAD">THREAD</a>
See <a href="#LICHAT-TCP-SERVER:SERVER">SERVER</a>
See <a href="#LICHAT-TCP-SERVER:CONNECTION">CONNECTION</a></pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:ESTABLISH-CONNECTION"> </a> <article> <header class="generic"> <span class="type">generic</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-TCP-SERVER:ESTABLISH-CONNECTION">ESTABLISH-CONNECTION</a></code></h4> <code class="qualifiers"></code> <code class="arguments">SOCKET SERVER</code><code>)</code>  </header> <div class="docstring"><pre>Responsible for establishing a new connection to a client.

This will construct and push a new CONNECTION object
onto the server using the given socket. It will also
launch the CONNECTION's background handling thread.</pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:HANDLE-CONNECTION"> </a> <article> <header class="generic"> <span class="type">generic</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-TCP-SERVER:HANDLE-CONNECTION">HANDLE-CONNECTION</a></code></h4> <code class="qualifiers"></code> <code class="arguments">SOCKET SERVER</code><code>)</code>  </header> <div class="docstring"><pre>Handle the socket with the given object.

The object should be either a SERVER or a CONNECTION.

In the case of the server, it will listen for new clients
and if one is found, call ESTABLISH-CONNECTION.

In the case of the client, it will first manage connection
establishment as per the Lichat protocol, then repeatedly
wait for a new update with a timeout. If the timeout is 
reached, a PING update is sent to the connection. If an
update is received, it is PROCESSED. If the socket ever
experiences a connection problem (timeout, shutdown, reset,
etc) then the connection is immediately closed.
Provides a CLOSE-CONNECTION restart as mandated by the
serverlib.

See <a href="#LICHAT-TCP-SERVER:SERVER">SERVER</a>
See <a href="#LICHAT-TCP-SERVER:CONNECTION">CONNECTION</a>
See <a href="#LICHAT-TCP-SERVER:ESTABLISH-CONNECTION">ESTABLISH-CONNECTION</a>
See <a href="NIL">LICHAT-SERVERLIB:PROCESS</a></pre></div> </article> </li><li> <a name="LICHAT-TCP-SERVER:OPEN-CONNECTION"> </a> <article> <header class="generic"> <span class="type">generic</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-TCP-SERVER:OPEN-CONNECTION">OPEN-CONNECTION</a></code></h4> <code class="qualifiers"></code> <code class="arguments">SERVER</code><code>)</code>  </header> <div class="docstring"><pre>Start accepting incoming connections on the server.

This will launch a background thread which will
call HANDLE-CONNECTION on the socket and server.

See <a href="#LICHAT-TCP-SERVER:HANDLE-CONNECTION">HANDLE-CONNECTION</a>
See <a href="#LICHAT-TCP-SERVER:THREAD">THREAD</a>
See <a href="#LICHAT-TCP-SERVER:SERVER">SERVER</a></pre></div> </article> </li></ul> </li></ul> </article>  </main> </body> </html> 